# Process Reward Models That Think ðŸ§ 

<div align="center">
  <a href="https://arxiv.org/abs/2504.16828">
    <img src="https://img.shields.io/badge/Paper-arXiv-red">
  </a>
  <a href="https://mukhal.github.io/projects/thinkprm/">
    <img src="https://img.shields.io/badge/Webpage-ThinkPRM-orange">
  </a>
  <a href="https://huggingface.co/datasets/launch/thinkprm-1K-verification-cots">
    <img src="https://img.shields.io/badge/%F0%9F%A4%97%20Hugging%20Face-Datasets-green">
  </a>
  <a href="https://huggingface.co/collections/launch/thinkprm-681d7a7c5e8bfcfb5fc6d7bb">
    <img src="https://img.shields.io/badge/%F0%9F%A4%97%20Hugging%20Face-Collections-blue">
  </a>
</div>



<div align="center" style="font-family: Arial, sans-serif;">
  <p>
    <a href="#news" style="text-decoration: none; font-weight: bold;">ðŸŽ‰ News</a> â€¢
    <a href="#introduction" style="text-decoration: none; font-weight: bold;">ðŸ“– Introduction</a>
    <a href="#data-collection" style="text-decoration: none; font-weight: bold;">ðŸ“„ Data Collection</a>

  </p>
  <p>
    <a href="#getting-started" style="text-decoration: none; font-weight: bold;">âœ¨ Getting Started</a> â€¢
    <a href="#citation" style="text-decoration: none; font-weight: bold;">ðŸŽˆ Citation</a>
  </p>
</div>

</div>

# ðŸŽ‰News
- **[2025-04-23]** Our [paper](https://arxiv.org/abs/2504.16828) is released on arxiv.
- **[2025-04-24]** Our synthetic verification CoTs used to train ThinkPRM on are now on [huggingface](https://huggingface.co/datasets/launch/thinkprm-1K-verification-cots). 
- **[2025-04-25]** Our trained PRMs are released in two sizes: [1.5B](https://huggingface.co/launch/ThinkPRM-1.5B) and [14B](https://huggingface.co/launch/ThinkPRM-14B) finetuned from R1-Distill-Qwen models.
- **[2025-05-16]** To provide a balanced performance between 1.5B and 14B, we have upload [ThinkPRM-7B](https://huggingface.co/launch/ThinkPRM-7B), based on Deepseek-R1-Distill-Qwen-7B and finetuned on our data. 

# ðŸ“–Introduction

We introduce ThinkPRM, a collection of generative long CoT process reward models. Our verifiers are obtained by finetuning reasoning models over 1K synthetic verification CoTs---filtered based on only on 8K process labels from PRM800K. The resulting verifiers outperform LLM-as-a-judge, discriminative PRMs, on most in- and out-of-domain setups. ThinkPRM enables scaling up verifier  compute either in parallel or sequentially by thinking longer.

<div align="center">
<img src="https://github.com/user-attachments/assets/4fc1a558-4005-4f2f-8b10-0c0b4616592f" alt="image" width="600"/>
</div>

# ðŸ“‘ Data Collection
ThinkPRM was trained on synthetic verification CoTs. This dataset contains 1,000 high-quality synthetic verification chains-of-thought (CoTs) designed for training generative Process Reward Models (PRMs), as used in the paper ["Process Reward Models that Think"](https://arxiv.org/abs/2504.16828). The goal was to create a data-efficient alternative to traditional PRM training which often requires extensive human annotation or expensive rollouts.

Each instance consists of a math problem, a corresponding multi-step solution prefix (sourced from PRM800K [Lightman et al., 2023]), and a detailed verification CoT generated by the [QwQ-32B-Preview](https://huggingface.co/Qwen/QwQ-32B-Preview). The verification CoT critiques each step of the solution prefix and provides a step-level correctness judgment (`\boxed{correct}` or `\boxed{incorrect}`).

To ensure high-quality synthetic CoTs, only chains where all step-level judgments matched the ground-truth human annotations from the PRM800K dataset were retained. They were also filtered based on correct formatting and length constraints to avoid issues like excessive overthinking observed in unfiltered generation. The figure below summarizes the synthetic cots collection. Refer to our paper for more details on data collection. 


![image.png](https://cdn-uploads.huggingface.co/production/uploads/5f350fe67e5835433862161b/OBLqBFn2zJfKIvnEAK2D_.png)


The dataset was created to enable efficient training of powerful generative PRMs. The core idea is that fine-tuning strong reasoning models on carefully curated, synthetic verification CoTs can yield verifiers that outperform models trained on much larger, traditionally labeled datasets. The process-based filtering (matching gold step labels) was shown to be crucial for generating high-quality training data compared to outcome-based filtering.


# âœ¨Getting Started

## Quick Start

1. **Installation**: Follow the installation instructions in the [search-and-learn README](search-and-learn/README.md)

2. **Running ThinkPRM**: Use the provided recipes to run ThinkPRM with different models and configurations:
   ```bash
   # Example: Run ThinkPRM with Qwen2.5-14B model
   python search-and-learn/scripts/test_time_compute.py \
     search-and-learn/recipes/MATH-100/Qwen2.5-14B/best_of_n_thinkprm.yaml \
     --dataset_name="HuggingFaceH4/MATH-500" \
     --model_path="Qwen/Qwen2.5-14B-Instruct" \
     --prm_type="thinkprm"
   ```

3. **Available Models**: 
   - [ThinkPRM-1.5B](https://huggingface.co/launch/ThinkPRM-1.5B)
   - [ThinkPRM-7B](https://huggingface.co/launch/ThinkPRM-7B) 
   - [ThinkPRM-14B](https://huggingface.co/launch/ThinkPRM-14B)

4. **Scaling Options**:
   - **Parallel Scaling**: Increase `prm_n` for parallel verification
   - **Sequential Scaling**: Increase `n_thinking_rounds` for sequential thinking
   - **Beam Search**: Use beam search approach for guided exploration

## Project Structure

```
â”œâ”€â”€ prm/                           # Process Reward Model implementations
â”‚   â”œâ”€â”€ sglang_thinkprm_verifier.py  # API-based ThinkPRM verifier
â”‚   â”œâ”€â”€ thinkprm_verifier.py         # Local ThinkPRM verifier
â”‚   â”œâ”€â”€ sglang_prm.py               # Generative PRM implementation
â”‚   â””â”€â”€ process_reward_model.py     # Discriminative PRM implementation
â”œâ”€â”€ search-and-learn/              # Main search and learning framework
â”‚   â”œâ”€â”€ scripts/                   # Execution scripts
â”‚   â”œâ”€â”€ recipes/                   # Configuration files
â”‚   â””â”€â”€ src/sal/                   # Core search algorithms
â””â”€â”€ README.md                      # This file
```


# ðŸŽˆCitation
If you find ThinkPRM helpful, please cite us.

```bibtex
@article{khalifa2025,
      title={Process Reward Models That Think}, 
      author={Muhammad Khalifa and Rishabh Agarwal and Lajanugen Logeswaran and Jaekyeom Kim and Hao Peng and Moontae Lee and Honglak Lee and Lu Wang},
      year={2025},
      journal={arXiv preprint arXiv:2504.16828},
      primaryClass={cs.LG},
      url={https://arxiv.org/abs/2504.16828}, 
}
```
